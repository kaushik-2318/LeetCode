SELECT t1.product_id, IFNULL(ROUND(SUM(t1.price * t2.units)/SUM(t2.units),2),0) as average_price from Prices as t1 LEFT JOIN UnitsSold as t2 ON t1.product_id = t2.product_id AND t2.purchase_date BETWEEN t1.start_date AND t1.end_date GROUP BY t1.product_id;